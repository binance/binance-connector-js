<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: websocket.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: websocket.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const { validateParameter } = require('../helpers/validation')
const WebSocketClient = require('ws')

/**
 * API websocket endpoints
 * @module Websocket
 * @param {*} superclass
 */
const Websocket = superclass => class extends superclass {
  constructor (options) {
    super(options)
    this.wsURL = options.wsURL || 'wss://stream.binance.com:9443'
  }

  /**
   * Aggregate Trade Streams&lt;br>
   *
   * The Aggregate Trade Streams push trade information that is aggregated for a single taker order.&lt;br>
   *
   * Stream Name: &amp;lt;symbol&amp;gt;@aggTrade &lt;br>
   * Update Speed: Real-time&lt;br>
   *
   * {@link https://binance-docs.github.io/apidocs/spot/en/#aggregate-trade-streams}
   *
   * @param {string} symbol
   */
  aggTradeWS (symbol, callbacks) {
    validateParameter(symbol, 'symbol')
    const url = `${this.wsURL}/ws/${symbol.toLowerCase()}@aggTrade`
    this.logger.debug(url)
    this.subscribe(url, callbacks)
  }

  /**
   * Trade Streams&lt;br>
   *
   * The Trade Streams push raw trade information; each trade has a unique buyer and seller.&lt;br>
   *
   * Stream Name: &amp;lt;symbol&amp;gt;@trade &lt;br>
   * Update Speed: Real-time&lt;br>
   *
   * {@link https://binance-docs.github.io/apidocs/spot/en/#trade-streams}
   *
   * @param {string} symbol
   */
  tradeWS (symbol, callbacks) {
    validateParameter(symbol, 'symbol')
    const url = `${this.wsURL}/ws/${symbol.toLowerCase()}@trade`
    this.logger.debug(url)
    this.subscribe(url, callbacks)
  }

  /**
   * Kline/Candlestick Streams&lt;br>
   *
   * The Kline/Candlestick Stream push updates to the current klines/candlestick every second.&lt;br>
   *
   * Stream Name: &amp;lt;symbol&amp;gt;@kline_&amp;lt;interval&amp;gt; &lt;br>
   * Update Speed: 2000ms &lt;br>
   *
   * {@link https://binance-docs.github.io/apidocs/spot/en/#kline-candlestick-streams}
   *
   * @param {string} symbol
   * @param {string} interval - m -> minutes; h -> hours; d -> days; w -> weeks; M -> months:&lt;br>
   *     1m, 3m, 5m, 15m, 30m, 1h, 2h, 4h, 6h, 8h, 12h, 1d, 3d, 1w, 1M
   */
  klineWS (symbol, interval, callbacks) {
    validateParameter(symbol, 'symbol')
    validateParameter(interval, 'interval')

    const url = `${this.wsURL}/ws/${symbol.toLowerCase()}@kline_${interval}`
    this.logger.debug(url)
    this.subscribe(url, callbacks)
  }

  /**
   * Individual symbol or all symbols mini ticker&lt;br>
   *
   * 24hr rolling window mini-ticker statistics.&lt;br>
   * These are NOT the statistics of the UTC day, but a 24hr rolling window for the previous 24hrs&lt;br>
   *
   * Stream Name: &amp;lt;symbol&amp;gt;@miniTicker or !miniTicker@arr &lt;br>
   * Update Speed: 1000ms &lt;br>
   *
   * {@link https://binance-docs.github.io/apidocs/spot/en/#individual-symbol-mini-ticker-stream}
   * &lt;br>
   * {@link https://binance-docs.github.io/apidocs/spot/en/#all-market-mini-tickers-stream}
   *
   * @param {string} [symbol]
   */
  miniTickerWS (symbol = null, callbacks) {
    let path = '!miniTicker@arr'
    if (symbol !== null &amp;&amp; symbol !== '') {
      path = `${symbol.toLowerCase()}@miniTicker`
    }
    const url = `${this.wsURL}/ws/${path}`
    this.logger.debug(url)
    this.subscribe(url, callbacks)
  }

  /**
   * Individual symbol or all symbols ticker&lt;br>
   *
   * 24hr rollwing window ticker statistics for a single symbol.&lt;br>
   * These are NOT the statistics of the UTC day, but a 24hr rolling window for the previous 24hrs.&lt;br>
   *
   * Stream Name: &amp;lt;symbol&amp;gt;@ticker or !ticker@arr &lt;br>
   * Update Speed: 1000ms&lt;br>
   *
   * {@link https://binance-docs.github.io/apidocs/spot/en/#individual-symbol-ticker-streams}
   * &lt;br>
   * {@link https://binance-docs.github.io/apidocs/spot/en/#all-market-tickers-stream}
   *
   * @param {string} [symbol]
   *
   */
  tickerWS (symbol = null, callbacks) {
    let path = '!ticker@arr'
    if (symbol !== null &amp;&amp; symbol !== '') {
      path = `${symbol.toLowerCase()}@ticker`
    }
    const url = `${this.wsURL}/ws/${path}`
    this.logger.debug(url)
    this.subscribe(url, callbacks)
  }

  /**
   * Individual symbol or all symbols book ticker&lt;br>
   *
   * Pushes any update to the best bid or ask's price or quantity in real-time.&lt;br>
   *
   * Stream Name: &amp;lt;symbol&amp;gt;@bookTicker or !bookTicker &lt;br>
   * Update Speed: Real-time&lt;br>
   *
   * {@link https://binance-docs.github.io/apidocs/spot/en/#individual-symbol-book-ticker-streams}
   * &lt;br>
   * {@link https://binance-docs.github.io/apidocs/spot/en/#all-book-tickers-stream}
   *
   * @param {string} [symbol]
   */
  bookTickerWS (symbol = null, callbacks) {
    let path = '!bookTicker'
    if (symbol !== null &amp;&amp; symbol !== '') {
      path = `${symbol.toLowerCase()}@bookTicker`
    }
    const url = `${this.wsURL}/ws/${path}`
    this.logger.debug(url)
    this.subscribe(url, callbacks)
  }

  /**
   * Partial Book Depth Streams&lt;br>
   *
   * Top bids and asks, Valid are 5, 10, or 20.&lt;br>
   *
   * Stream Names: &amp;lt;symbol&amp;gt;@depth&amp;lt;levels&amp;gt; or &amp;lt;symbol&amp;gt;@depth&amp;lt;levels&amp;gt;@100ms. &lt;br>
   * Update Speed: 1000ms or 100ms&lt;br>
   *
   * {@link https://binance-docs.github.io/apidocs/spot/en/#partial-book-depth-streams}
   *
   * @param {string} symbol
   * @param {string} levels - 5, 10, or 20
   * @param {string} speed - 1000ms or 100ms
   *
   */
  partialBookDepth (symbol, levels, speed, callbacks) {
    validateParameter(symbol, 'symbol')
    validateParameter(levels, 'levels')
    validateParameter(speed, 'speed')

    const url = `${this.wsURL}/ws/${symbol.toLowerCase()}@depth${levels}@${speed}`
    this.logger.debug(url)
    this.subscribe(url, callbacks)
  }

  /**
   * Diff. Depth Stream&lt;br>
   *
   * Order book price and quantity depth updates used to locally manage an order book.&lt;br>
   *
   * Stream Names: &amp;lt;symbol&amp;gt;@depth or &amp;lt;symbol&amp;gt;@depth@100ms &lt;br>
   * Update Speed: 1000ms or 100ms&lt;br>
   *
   * {@link https://binance-docs.github.io/apidocs/spot/en/#diff-depth-stream}
   *
   * @param {string} symbol
   * @param {string} speed - 1000ms or 100ms
   *
   */
  diffBookDepth (symbol, speed, callbacks) {
    validateParameter(symbol, 'symbol')
    validateParameter(speed, 'speed')

    const url = `${this.wsURL}/ws/${symbol.toLowerCase()}@depth@${speed}`
    this.logger.debug(url)
    this.subscribe(url, callbacks)
  }

  /**
   * Listen to User data stream&lt;br>
   *
   * {@link https://binance-docs.github.io/apidocs/spot/en/#user-data-streams}
   *
   * @param {string} listenKey
   */
  userData (listenKey, callbacks) {
    validateParameter(listenKey, 'listenKey')

    const url = `${this.wsURL}/ws/${listenKey}`
    this.logger.debug(url)
    this.subscribe(url, callbacks)
  }

  /**
   * Listen to market streams&lt;br>
   *
   * {@link https://binance-docs.github.io/apidocs/spot/en/#websocket-market-streams}
   *
   * @param {array} streams
   *
   * e.g. client.combinedStreams(['btcusdt@miniTicker', 'ethusdt@tikcer'], callbacks)
   */
  combinedStreams (streams, callbacks) {
    if (!Array.isArray(streams)) {
      streams = [streams]
    }

    const url = `${this.wsURL}/stream?streams=${streams.join('/')}`
    this.logger.debug(url)
    this.subscribe(url, callbacks)
  }

  subscribe (url, callbacks) {
    const ws = new WebSocketClient(url)
    Object.keys(callbacks).forEach((event, _) => {
      this.logger.debug(`listen to event: ${event}`)
      ws.on(event, callbacks[event])
    })

    ws.on('ping', () => {
      this.logger.debug('Received ping from server')
      ws.pong()
    })

    ws.on('pong', () => {
      this.logger.debug('Received pong from server')
    })
  }
}

module.exports = Websocket
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Blvt.html">Blvt</a></li><li><a href="module-Bswap.html">Bswap</a></li><li><a href="module-Margin.html">Margin</a></li><li><a href="module-Market.html">Market</a></li><li><a href="module-Mining.html">Mining</a></li><li><a href="module-Savings.html">Savings</a></li><li><a href="module-Stream.html">Stream</a></li><li><a href="module-SubAccount.html">SubAccount</a></li><li><a href="module-Trade.html">Trade</a></li><li><a href="module-Wallet.html">Wallet</a></li><li><a href="module-Websocket.html">Websocket</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Tue Jun 01 2021 10:28:59 GMT+0800 (Singapore Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
